{"version":3,"file":"js/473.9cb645e0.js","mappings":"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","sources":["webpack://hmmm-frontend-vue3-dev/./src/api/base/permissions.js","webpack://hmmm-frontend-vue3-dev/./src/module-manage/components/permissions-add.vue","webpack://hmmm-frontend-vue3-dev/./src/module-manage/components/permissions-add.vue?cd8e"],"sourcesContent":["import { createAPI } from '@/utils/request'\r\n\r\nexport const list = (data) => createAPI('/permissions', 'get', data)\r\nexport const simple = (data) => createAPI('/permissions/simple', 'get', data)\r\nexport const add = (data) => createAPI('/permissions', 'post', data)\r\nexport const update = (data) =>\r\n  createAPI(`/permissions/${data.id}`, 'put', data)\r\nexport const remove = (data) =>\r\n  createAPI(`/permissions/${data.id}`, 'delete', data)\r\nexport const detail = (data) =>\r\n  createAPI(`/permissions/${data.id}`, 'get', data)\r\n","<template>\r\n  <div class=\"add-form\">\r\n    <el-dialog :title=\"text + pageTitle\" v-model=\"dialogFormVisible\">\r\n      <el-form\r\n        :rules=\"ruleInline\"\r\n        ref=\"dataForm\"\r\n        :model=\"formBase\"\r\n        label-position=\"left\"\r\n        label-width=\"120px\"\r\n        style=\"width: 400px; margin-left: 120px\"\r\n      >\r\n        <el-form-item :label=\"$t('table.username')\" prop=\"title\">\r\n          <el-input v-model=\"formBase.title\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item :label=\"$t('table.powerDistriB')\">\r\n          <el-tree\r\n            ref=\"treeMenu\"\r\n            :data=\"treeData\"\r\n            show-checkbox\r\n            node-key=\"id\"\r\n            :default-expanded-keys=\"[0]\"\r\n            :default-checked-keys=\"formBase.permissions\"\r\n            :props=\"defaultProps\"\r\n            @check=\"handleCheckChange\"\r\n          ></el-tree>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template v-slot:footer>\r\n        <div class=\"dialog-footer\">\r\n          <el-button @click=\"handleClose\">{{ $t('table.cancel') }}</el-button>\r\n          <el-button type=\"primary\" @click=\"handleAdd('formBase')\">{{\r\n            $t('table.confirm')\r\n          }}</el-button>\r\n        </div>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { $on, $off, $once, $emit } from '../../utils/gogocodeTransfer'\r\nimport { detail, update, add } from '@/api/base/permissions'\r\nimport { list } from '@/api/base/menus.js'\r\nlet _this = []\r\nexport default {\r\n  name: 'usersAdd',\r\n  props: ['text', 'pageTitle', 'ruleInline'],\r\n  data () {\r\n    return {\r\n      dialogFormVisible: false,\r\n      PermissionGroupsmenu: [],\r\n      defaultProps: {\r\n        label: 'title'\r\n      },\r\n      permissions: [],\r\n      treeCheckedNodes: [],\r\n      formBase: {\r\n        id: 0,\r\n        create_date: '',\r\n        title: '',\r\n        permissions: []\r\n      },\r\n      curPermissions: []\r\n    }\r\n  },\r\n  computed: {\r\n    treeData () {\r\n      function createNode (item) {\r\n        // 复选框选择\r\n        let checked = false\r\n        let selected = false\r\n        if (_this !== null && _this.formBase.permissions.length > 0) {\r\n          const per = _this.formBase.permissions.find(function (value, index) {\r\n            return value === item.id\r\n          })\r\n          selected = !!per\r\n        }\r\n        // 标记勾选\r\n        if (selected) {\r\n          const isPoint = item.childs === undefined && item.points === undefined\r\n          const hasChilds = item.childs !== undefined && item.childs.length > 0\r\n          const hasPoints = item.points !== undefined && item.points.length > 0\r\n          if (isPoint) {\r\n            checked = true\r\n          } else if (hasPoints) {\r\n            checked = false\r\n          } else if (hasChilds) {\r\n            checked = false\r\n          } else {\r\n            checked = true\r\n          }\r\n        }\r\n        return {\r\n          id: item.id === undefined ? 0 : item.id,\r\n          title: item.title,\r\n          children: [],\r\n          selected: selected,\r\n          checked: checked\r\n        }\r\n      }\r\n      function parseNodes (nodes, parentNode) {\r\n        for (const it of nodes) {\r\n          const node = createNode(it)\r\n          // 标记选中\r\n          // console.log(node.checked)\r\n          if (node.checked) {\r\n            parentNode.selected = true\r\n          }\r\n          if (it.childs !== undefined && it.childs.length > 0) {\r\n            parseNodes(it.childs, node)\r\n          } else if (it.points !== undefined && it.points.length > 0) {\r\n            parseNodes(it.points, node)\r\n          }\r\n          parentNode.children.push(node)\r\n        }\r\n      }\r\n      const nodes = createNode({ title: '系统菜单和页面权限点', expand: true })\r\n      parseNodes(this.PermissionGroupsmenu, nodes)\r\n      return [nodes]\r\n    }\r\n  },\r\n  methods: {\r\n    // 弹层显示\r\n    dialogFormV () {\r\n      this.dialogFormVisible = true\r\n    },\r\n    // 弹层隐藏\r\n    dialogFormH () {\r\n      this.dialogFormVisible = false\r\n    },\r\n    // 退出\r\n    handleClose () {\r\n      $emit(this, 'handleCloseModal')\r\n    },\r\n    // 表单重置\r\n    handleResetForm () {\r\n      this.formBase = {\r\n        id: 0,\r\n        title: '',\r\n        permissions: []\r\n      }\r\n    },\r\n    // 编辑详情数据加载\r\n    hanldeEditForm (objeditId) {\r\n      this.formBase.id = objeditId\r\n      const data = {\r\n        id: objeditId\r\n      }\r\n      detail(data).then((ret, err) => {\r\n        if (err) {\r\n          return err\r\n        }\r\n        this.formBase.id = ret.data.id\r\n        this.formBase.title = ret.data.title\r\n        this.formBase.permissions = ret.data.permissions\r\n      })\r\n    },\r\n    setupData () {\r\n      list().then((data) => {\r\n        this.PermissionGroupsmenu = data.data\r\n      })\r\n    },\r\n\r\n    // 节点复选框被选中\r\n    handleCheckChange (data, checked, indeterminate) {\r\n      this.treeCheckedNodes = checked.checkedNodes\r\n    },\r\n    // 表单提交\r\n    handleAdd (object) {\r\n      // 读取完整节点\r\n      const curPermissions = new Set()\r\n      // function parse(nodes, selectedId) {\r\n      //   for (const it of nodes) {\r\n      //     let isFind = false\r\n      //     if (it.childs !== undefined) {\r\n      //       isFind = parse(it.childs, selectedId)\r\n      //     }\r\n      //     if (it.points !== undefined) {\r\n      //       isFind = parse(it.points, selectedId)\r\n      //     }\r\n      //     if (it.id === selectedId) {\r\n      //       isFind = true\r\n      //     }\r\n      //     if (isFind) {\r\n      //       curPermissions.add(it.id)\r\n      //       return true\r\n      //     }\r\n      //   }\r\n      //   return false\r\n      // }\r\n      // 已选中的控件节点\r\n      if (this.treeCheckedNodes.length === 0) {\r\n        this.treeCheckedNodes = this.$refs.treeMenu.getCheckedNodes()\r\n        if (this.treeCheckedNodes.length === 0) {\r\n          return\r\n        }\r\n      }\r\n      // 读取\r\n      for (const it of this.treeCheckedNodes) {\r\n        // parse(this.PermissionGroupsmenu, it.id)\r\n        curPermissions.add(it.id)\r\n      }\r\n      this.curPermissions = Array.from(curPermissions)\r\n      // 保存\r\n      if (this.curPermissions.length === 0) {\r\n        this.$message({\r\n          showClose: true,\r\n          message: '请选择需要的权限及页面权限点',\r\n          type: 'error'\r\n        })\r\n      } else {\r\n        this.dataFormSub(this.curPermissions)\r\n      }\r\n    },\r\n    nodeDate (nodesPath, curPermissions, findId) {\r\n      nodesPath.forEach(function (item, index) {\r\n        if (curPermissions.indexOf(item.id) === -1) {\r\n          curPermissions.push(findId)\r\n        }\r\n      })\r\n    },\r\n    dataFormSub (curPermis) {\r\n      this.$refs.dataForm.validate((valid) => {\r\n        if (valid) {\r\n          $emit(this, 'handleCloseModal')\r\n          if (_this.formBase.id) {\r\n            const technologyTypes = []\r\n            const data = {\r\n              id: this.formBase.id,\r\n              title: this.formBase.title,\r\n              permissions: curPermis\r\n            }\r\n            update(data).then(() => {\r\n              $emit(this, 'newDataes', this.formBase)\r\n            })\r\n          } else {\r\n            add({\r\n              title: this.formBase.title,\r\n              permissions: curPermis\r\n            }).then(() => {\r\n              $emit(this, 'newDataes', this.formBase)\r\n            })\r\n          }\r\n        } else {\r\n          this.$Message.error('*号为必填项!')\r\n        }\r\n      })\r\n    }\r\n  },\r\n  // 挂载结束\r\n\r\n  mounted: function () {},\r\n  // 创建完毕状态\r\n  created () {\r\n    _this = this\r\n    this.setupData()\r\n  },\r\n  // 组件更新\r\n  updated: function () {},\r\n  emits: ['newDataes', 'handleCloseModal']\r\n}\r\n</script>\r\n\r\n<style>\r\n.el-tree {\r\n  margin-top: 8px;\r\n}\r\n.el-tree-node__content {\r\n  height: auto;\r\n}\r\n.el-form--label-left .el-form-item__label {\r\n  text-align: right;\r\n}\r\n.el-dialog__footer {\r\n  text-align: right;\r\n}\r\n</style>\r\n","import { render } from \"./permissions-add.vue?vue&type=template&id=3aa0ce3a\"\nimport script from \"./permissions-add.vue?vue&type=script&lang=js\"\nexport * from \"./permissions-add.vue?vue&type=script&lang=js\"\n\nimport \"./permissions-add.vue?vue&type=style&index=0&id=3aa0ce3a&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["list","data","createAPI","simple","add","update","id","remove","detail","class","_createElementBlock","_hoisted_1","_createVNode","_component_el_dialog","title","$props","text","pageTitle","$data","dialogFormVisible","$event","footer","_withCtx","_createElementVNode","_hoisted_2","_component_el_button","onClick","$options","handleClose","_ctx","$t","type","_cache","handleAdd","_component_el_form","rules","ruleInline","ref","model","formBase","style","_component_el_form_item","label","prop","_component_el_input","_component_el_tree","treeData","permissions","props","defaultProps","onCheck","handleCheckChange","_this","name","PermissionGroupsmenu","treeCheckedNodes","create_date","curPermissions","computed","createNode","item","checked","selected","length","per","find","value","index","isPoint","undefined","childs","points","hasChilds","hasPoints","children","parseNodes","nodes","parentNode","it","node","push","expand","this","methods","dialogFormV","dialogFormH","$emit","handleResetForm","hanldeEditForm","objeditId","then","ret","err","setupData","indeterminate","checkedNodes","object","Set","$refs","treeMenu","getCheckedNodes","Array","from","$message","showClose","message","dataFormSub","nodeDate","nodesPath","findId","forEach","indexOf","curPermis","dataForm","validate","valid","$Message","error","mounted","created","updated","emits","__exports__","render"],"sourceRoot":""}